<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Onyx — Store</title>
<style>
  /* ========= Base / Reset ========= */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color:#fff;
    background:#060010;
    overflow-y:auto; /* ensure scrolling */
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* ========= Cosmos Background ========= */
  #star-canvas{position:fixed;inset:0;z-index:0;display:block}
  /* Brighter, more visible nebula */
  .nebula{
    position:fixed;inset:0;z-index:0;pointer-events:none;
    background:
      radial-gradient(1200px 800px at 18% 22%, rgba(226, 74, 255, 0.24), transparent 55%),
      radial-gradient(1000px 760px at 78% 78%, rgba(66, 162, 255, 0.22), transparent 58%),
      radial-gradient(800px 600px at 52% 46%, rgba(255, 58, 170, 0.18), transparent 60%),
      radial-gradient(700px 500px at 22% 74%, rgba(120, 255, 230, 0.16), transparent 62%);
    filter: blur(36px) saturate(1.05);
    mix-blend-mode: screen;
    animation: nebFloat 28s linear infinite, nebPulse 10s ease-in-out infinite;
  }
  @keyframes nebFloat{0%{transform:translateY(0)}50%{transform:translateY(-36px)}100%{transform:translateY(0)}}
  @keyframes nebPulse{0%{opacity:.9}50%{opacity:1}100%{opacity:.9}}
  .gloss{position:fixed;inset:0;z-index:0;pointer-events:none;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);mix-blend-mode:overlay;opacity:.5}

  /* ========= Header ========= */
  header{
    position:relative;z-index:5;
    display:flex;justify-content:space-between;align-items:center;
    padding:24px 36px;
    background:linear-gradient(90deg, rgba(140,0,255,.10), rgba(255,50,170,.06));
    border-bottom:1px solid rgba(255,255,255,.06);
    backdrop-filter: blur(8px);
  }
  header h1{font-size:36px;color:#ffe4ff;letter-spacing:.5px;text-shadow:0 0 14px rgba(200,100,255,.14)}
  .cart-button{
    display:inline-flex;align-items:center;gap:10px;
    background:linear-gradient(90deg,#fff,#f9f9ff);
    color:#4a0066;border:none;border-radius:16px;
    padding:14px 20px;font-weight:900;font-size:18px;cursor:pointer;
    box-shadow:0 14px 44px rgba(160,0,220,.16);
    transition:transform .18s, box-shadow .18s;
  }
  .cart-button:hover{transform:translateY(-4px);box-shadow:0 22px 60px rgba(170,0,220,.2)}
  #cart-count{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#ffd6ff,#ffc0ea);color:#160018;font-weight:900;transition:transform .25s}

  /* ========= Claim banner ========= */
  .claim-banner{
    position:relative;z-index:5;
    max-width:1280px;margin:18px auto 10px;padding:16px 20px;text-align:center;
    color:#ffd7ea;font-weight:900;border-radius:16px;
    background:linear-gradient(90deg, rgba(255,10,120,.12), rgba(255,120,180,.08));
    border:1px solid rgba(255,0,140,.2);
    box-shadow:0 16px 60px rgba(255,0,160,.12);
    animation: floatY 6s ease-in-out infinite;
  }
  .claim-banner a{color:#ffd0ff;text-decoration:underline}
  @keyframes floatY{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

  /* ========= Layout ========= */
  .container{
    position:relative;z-index:4;
    max-width:1400px;margin:14px auto 80px;padding:0 24px;
    display:flex;gap:28px;align-items:flex-start;
  }
  .sidebar{
    width:330px;min-width:280px;
    background:linear-gradient(180deg, rgba(16,6,38,.85), rgba(8,3,30,.85));
    padding:22px;border-radius:18px;
    border:1px solid rgba(220,150,255,.12);
    box-shadow:0 28px 100px rgba(0,0,0,.6);
    transform-origin:left center;animation: sidebarIn .6s both;
  }
  @keyframes sidebarIn{from{transform:translateX(-10px) scale(.995);opacity:0}to{transform:none;opacity:1}}
  .cat-btn{
    display:block;width:100%;margin-bottom:12px;padding:16px 16px;border:none;border-radius:14px;
    background:linear-gradient(90deg,#7e00ff,#ff1599);
    color:#fff;font-weight:900;font-size:18px;cursor:pointer;
    box-shadow:0 14px 42px rgba(140,0,255,.18);
    transition:transform .14s, box-shadow .14s, filter .14s;
  }
  .cat-btn:hover{transform:translateY(-6px);box-shadow:0 20px 56px rgba(140,0,255,.22);filter:brightness(1.04)}

  .products{
    flex:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));
    gap:28px;align-content:start;padding-bottom:40px;
  }
  .product{
    background:linear-gradient(180deg, rgba(40,8,80,.92), rgba(6,2,20,.92));
    border:1px solid rgba(200,0,255,.12);
    border-radius:18px;padding:22px;
    box-shadow:0 30px 100px rgba(0,0,0,.75);
    transition:transform .18s, box-shadow .18s, filter .18s;
    transform-origin:center;animation: cardIn .55s cubic-bezier(.2,.9,.3,1) both;
  }
  @keyframes cardIn{from{transform:translateY(12px) scale(.98);opacity:0}to{transform:none;opacity:1}}
  .product:hover{transform:translateY(-10px) scale(1.02);box-shadow:0 44px 130px rgba(180,0,255,.18);filter:brightness(1.03)}
  .product img{width:100%;height:240px;object-fit:cover;border-radius:14px;margin-bottom:14px;background:linear-gradient(180deg,#1a0b26,#0b0712)}
  .product h3{font-size:22px;margin-bottom:6px}
  .product .price{font-size:19px;color:#ffdff4;font-weight:900;margin-bottom:12px}
  .actions{display:flex;gap:12px;align-items:center}
  .add-btn{
    flex:1;padding:14px;border-radius:14px;border:none;
    background:linear-gradient(90deg,#ff66ff,#9c00ff);
    color:#120018;font-weight:900;font-size:18px;cursor:pointer;transition:transform .12s;
  }
  .add-btn:hover{transform:translateY(-6px)}

  /* ========= Intro overlay ========= */
  .intro{position:fixed;inset:0;z-index:8;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at center, rgba(0,0,0,.6), rgba(0,0,0,.9));backdrop-filter:blur(8px)}
  .intro-card{width:min(920px,96%);padding:44px;border-radius:20px;background:linear-gradient(180deg,rgba(16,6,38,.98),rgba(8,3,30,.99));border:1px solid rgba(220,150,255,.14);box-shadow:0 40px 140px rgba(4,0,20,.9)}
  .intro h2{font-size:42px;margin-bottom:10px;color:#ffdffb}
  .choices{display:flex;gap:26px;justify-content:center;margin-top:24px;flex-wrap:wrap}
  .choice{
    background:linear-gradient(90deg,#6b00ff,#ff2288);
    padding:20px 30px;border-radius:16px;color:#fff;font-weight:900;font-size:22px;
    cursor:pointer;border:2px solid rgba(255,255,255,.04);transition:transform .14s, box-shadow .14s;
    box-shadow:0 20px 60px rgba(150,0,255,.16);
  }
  .choice:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 26px 80px rgba(150,0,255,.2)}

  /* ========= Modal / Checkout ========= */
  .modal{position:fixed;inset:0;z-index:12;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,.92));padding:26px}
  .modal-card{width:720px;background:linear-gradient(180deg, rgba(18,6,60,.97), rgba(10,3,40,.98));border-radius:18px;padding:22px;border:1px solid rgba(200,0,255,.14);box-shadow:0 44px 140px rgba(0,0,0,.95)}
  .checkout-item{display:flex;justify-content:space-between;padding:12px;border-radius:12px;background:rgba(255,255,255,.03);margin-bottom:10px}
  .checkout-footer{display:flex;justify-content:space-between;align-items:center;margin-top:18px;gap:12px}

  .btn-primary{
    background:linear-gradient(90deg,#ff66ff,#9c00ff);
    color:#120018;border:none;padding:16px 22px;border-radius:14px;
    font-weight:900;font-size:20px;cursor:pointer;
    box-shadow:0 18px 50px rgba(200,0,255,.16);
    transition:transform .14s,box-shadow .14s;
  }
  .btn-primary:hover{transform:translateY(-6px);box-shadow:0 28px 80px rgba(200,0,255,.2)}
  .btn-secondary{
    background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    color:#fff;border:none;padding:14px 18px;border-radius:14px;
    font-weight:800;font-size:18px;cursor:pointer;
    box-shadow:0 10px 30px rgba(0,0,0,.5);transition:transform .12s;
  }
  .btn-secondary:hover{transform:translateY(-5px)}

  .payment-pills{display:flex;gap:10px;background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));padding:6px;border-radius:999px;align-items:center}
  .pill{padding:10px 16px;border-radius:999px;border:none;background:transparent;color:#ddd;font-weight:800;cursor:pointer;transition:all .15s}
  .pill.active{background:linear-gradient(90deg,#ffd1ff,#ff9bdc);color:#140018;box-shadow:0 10px 28px rgba(200,0,255,.16);transform:translateY(-4px)}

  /* ========= Star fly animation helpers ========= */
  .fly-star{position:fixed;z-index:50;font-size:30px;pointer-events:none;}
  .trail{position:fixed;z-index:49;font-size:14px;pointer-events:none;opacity:.95;filter:blur(.6px);}

  /* ========= Responsive ========= */
  @media (max-width:1100px){
    .container{flex-direction:column;padding-bottom:120px}
    .sidebar{width:100%;min-width:unset;display:flex;gap:10px;overflow-x:auto}
    .products{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .product img{height:180px}
    .modal-card{width:94%}
    header h1{font-size:30px}
  }
</style>
</head>
<body>

<!-- =================== CONFIG: Edit only these arrays to change products =================== -->
<script>
  // Your Discord invite for the Buy action:
  const DISCORD_INVITE = "https://discord.gg/qZvny4sWZs";

  // "Grow a garden stuff" mode
  const productsGarden = {
    all: [
      { id: "g1", name: "Placeholder Product 1", price: "2.50", img: null },
      { id: "g2", name: "Placeholder Product 2", price: "3.00", img: null }
    ],
    "Placeholder 1": [
      { id: "g3", name: "Placeholder Product 3", price: "6.00", img: null },
      { id: "g4", name: "Placeholder Product 4", price: "4.50", img: null }
    ],
    "Placeholder 2": [
      { id: "g5", name: "Placeholder Product 5", price: "8.00", img: null },
      { id: "g6", name: "Placeholder Product 6", price: "5.50", img: null }
    ],
    "Placeholder 3": [
      { id: "g7", name: "Placeholder Product 7", price: "7.00", img: null }
    ]
  };

  // "Server designing" mode
  const productsServer = {
    all: [
      { id: "s1", name: "Placeholder Product 8", price: "6.00", img: null },
      { id: "s2", name: "Placeholder Product 9", price: "7.50", img: null }
    ],
    "Placeholder 1": [
      { id: "s3", name: "Placeholder Product 10", price: "3.50", img: null }
    ],
    "Placeholder 2": [
      { id: "s4", name: "Placeholder Product 11", price: "12.00", img: null },
      { id: "s5", name: "Placeholder Product 12", price: "25.00", img: null }
    ]
  };

  // (Optional) also expose on window
  window.productsGarden = productsGarden;
  window.productsServer = productsServer;
</script>

<!-- Background layers -->
<canvas id="star-canvas" aria-hidden="true"></canvas>
<div class="nebula" aria-hidden="true"></div>
<div class="gloss" aria-hidden="true"></div>

<!-- Header -->
<header>
  <h1>Onyx</h1>
  <button class="cart-button" onclick="openCart()">🛒 Cart <span id="cart-count">0</span></button>
</header>

<!-- Claim banner -->
<div class="claim-banner">
  ⚠️ To claim purchased items, please join our <a id="discord-link" href="#" target="_blank" rel="noopener">Discord server</a>.
</div>

<!-- Intro selection -->
<div id="intro" class="intro" role="dialog" aria-modal="true">
  <div class="intro-card">
    <h2>What are you looking for?</h2>
    <p style="color:#e8d6ff;font-weight:800;margin-top:8px;font-size:16px">Choose an option to view matching items.</p>
    <div class="choices">
      <button class="choice" onclick="selectMode('garden')">Grow a garden stuff</button>
      <button class="choice" onclick="selectMode('server')">Server designing</button>
    </div>
  </div>
</div>

<!-- Main content -->
<div class="container" id="main-content" aria-hidden="true">
  <aside class="sidebar" id="category-list" aria-label="Categories">
    <!-- categories injected -->
  </aside>
  <section class="products" id="products" aria-live="polite">
    <!-- products injected -->
  </section>
</div>

<!-- Checkout modal -->
<div id="cart-modal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-card">
    <h2 style="color:#ffd7ff;margin-bottom:10px">Checkout</h2>

    <div id="cart-items" style="max-height:440px;overflow:auto;margin-bottom:14px"></div>

    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="font-weight:900;color:#e6d6ff">Payment:</div>
        <div class="payment-pills" role="tablist" id="payment-pills">
          <button class="pill active" data-val="paypal" onclick="selectPayment(this)">PayPal</button>
          <button class="pill" data-val="roblox" onclick="selectPayment(this)">Roblox</button>
        </div>
      </div>
      <div id="cart-total" style="font-weight:900;color:#ffd7ff;font-size:20px">Total: $0.00</div>
    </div>

    <div class="checkout-footer">
      <button class="btn-primary" onclick="buyItems()">Buy</button>
      <button class="btn-secondary" onclick="closeCart()">Close</button>
    </div>
  </div>
</div>

<audio id="click-sound" src="click.mp3" preload="auto"></audio>

<script>
/* ===================== Star Canvas ===================== */
const canvas = document.getElementById('star-canvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; initStars(); });

const rand = (a,b)=>Math.random()*(b-a)+a;
let stars = [];
const STAR_COUNT = ()=> Math.floor((innerWidth*innerHeight)/22000) + 160;

function initStars(){
  stars = [];
  for(let i=0;i<STAR_COUNT();i++){
    stars.push({
      x: Math.random()*W,
      y: Math.random()*H,
      z: rand(.2,1.2),
      r: rand(.3,2.2),
      dx: rand(-.04,.04),
      dy: rand(-.03,.03),
      tw: Math.random()*1.8
    });
  }
}
initStars();

let t=0;
(function draw(){
  ctx.clearRect(0,0,W,H);
  const g = ctx.createLinearGradient(0,0,W,H);
  g.addColorStop(0,'rgba(255,120,220,.025)'); g.addColorStop(1,'rgba(60,180,255,.02)');
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  for(const s of stars){
    const tw = Math.sin(t*0.02*s.tw)*0.7 + 0.9;
    const size = s.r * s.z * tw;
    ctx.beginPath();
    ctx.fillStyle = `rgba(255,255,255,${.55 * s.z * tw})`;
    ctx.arc(s.x, s.y, Math.max(.2,size), 0, Math.PI*2);
    ctx.fill();
    s.x += s.dx*(1+.6*s.z);
    s.y += s.dy*(1+.6*s.z);
    if(s.x < -10) s.x = W+10; if(s.x > W+10) s.x = -10;
    if(s.y < -10) s.y = H+10; if(s.y > H+10) s.y = -10;
  }
  t++; requestAnimationFrame(draw);
})();

/* ===================== App State ===================== */
let mode = null; // 'garden' | 'server'
let cart = [];
let selectedPayment = 'paypal';

function playClick(){ const a = document.getElementById('click-sound'); if(a && a.play){ try{ a.play(); }catch(e){} } }
function dataURLPlaceholder(text,w=900,h=600,bg='#1e0b2a',fg='#ffdff8'){
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'><rect width='100%' height='100%' fill='${bg}' rx='12'/><g font-family='Segoe UI, Tahoma, Verdana' font-weight='800' fill='${fg}' font-size='36' text-anchor='middle'><text x='50%' y='50%'>${text}</text></g></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

function getData(){ return mode==='garden' ? (window.productsGarden||{}) : (mode==='server' ? (window.productsServer||{}) : {}); }

/* Aggregate ALL products in insertion order:
   1) all[]
   2) then each other category in the order it was defined */
function getAllAggregated(data){
  const out = [];
  if(data && Array.isArray(data.all)) out.push(...data.all);
  Object.keys(data||{}).forEach(k=>{
    if(k==='all') return;
    const arr = data[k];
    if(Array.isArray(arr)) out.push(...arr);
  });
  return out;
}

/* ===== Render categories (includes explicit All Products at top) ===== */
function renderCategories(){
  const catList = document.getElementById('category-list');
  catList.innerHTML = '';

  const back = document.createElement('button');
  back.className='cat-btn';
  back.textContent='Back to choices';
  back.onclick = resetIntro;
  catList.appendChild(back);

  // Always show explicit "All Products"
  const allBtn = document.createElement('button');
  allBtn.className='cat-btn';
  allBtn.textContent='All Products';
  allBtn.onclick = ()=>{ playClick(); showProducts('__ALL__'); };
  catList.appendChild(allBtn);

  // Then the real placeholder categories (excluding possible "all")
  const data = getData();
  Object.keys(data||{}).forEach(key=>{
    if(key==='all') return;
    const b = document.createElement('button');
    b.className='cat-btn';
    b.textContent = key; // already "Placeholder X"
    b.onclick = ()=>{ playClick(); showProducts(key); };
    catList.appendChild(b);
  });
}

/* ===== Show products for category or aggregated ===== */
function showProducts(categoryKey){
  const container = document.getElementById('products');
  container.innerHTML = '';

  const data = getData();
  let items = [];

  if(categoryKey === '__ALL__'){
    items = getAllAggregated(data);
  } else if(categoryKey && (data[categoryKey] !== undefined)) {
    items = data[categoryKey];
  } else if(String(categoryKey).toLowerCase()==='all'){
    // If someone still calls 'all', aggregate to be safe:
    items = getAllAggregated(data);
  } else {
    items = [];
  }

  if(!items || items.length===0){
    container.innerHTML = `<div style="padding:20px;border-radius:12px;background:rgba(255,255,255,.03);color:#ddd">No items</div>`;
    return;
  }

  items.forEach(p=>{
    const card = document.createElement('div'); card.className='product';
    const imgSrc = p.img || dataURLPlaceholder('Image');
    card.innerHTML = `
      <img src="${imgSrc}" alt="${p.name}">
      <h3>${p.name}</h3>
      <div class="price">$${parseFloat(p.price).toFixed(2)}</div>
      <div class="actions">
        <button class="add-btn" data-id="${p.id}">Add to Cart</button>
      </div>`;
    container.appendChild(card);

    const btn = card.querySelector('.add-btn');
    const imgEl = card.querySelector('img');
    btn.addEventListener('click', ()=> animateAddToCartAndAdd(p, imgEl));
  });
}

/* ===== Intro selection ===== */
function selectMode(selected){
  playClick();
  mode = selected;
  document.getElementById('intro').style.display = 'none';
  document.getElementById('main-content').setAttribute('aria-hidden','false');
  renderCategories();
  // Default to explicit "All Products" aggregation
  showProducts('__ALL__');
}
function resetIntro(){
  playClick();
  mode = null; cart = []; updateCartCount();
  document.getElementById('intro').style.display = 'flex';
  document.getElementById('main-content').setAttribute('aria-hidden','true');
  document.getElementById('products').innerHTML = '';
  renderCategories();
}

/* ===== Cart ===== */
function updateCartCount(){
  const el = document.getElementById('cart-count'); el.textContent = cart.length;
  el.animate([{transform:'scale(1)'},{transform:'scale(1.25)'},{transform:'scale(1)'}],{duration:360,easing:'cubic-bezier(.2,.9,.3,1)'});
}
function openCart(){
  playClick();
  const modal = document.getElementById('cart-modal');
  const items = document.getElementById('cart-items'); items.innerHTML = '';
  if(cart.length === 0){
    items.innerHTML = `<div style="padding:18px;color:#ddd">Your cart is empty.</div>`;
    document.getElementById('cart-total').textContent = 'Total: $0.00';
  } else {
    let total = 0;
    cart.forEach((p,i)=>{
      const price = parseFloat(p.price)||0; total += price;
      const row = document.createElement('div'); row.className='checkout-item';
      row.innerHTML = `<div style="font-weight:900">${p.name}</div>
        <div style="display:flex;gap:12px;align-items:center">
          <div style="font-weight:900">$${price.toFixed(2)}</div>
          <button style="background:none;border:none;color:#ff9bbd;cursor:pointer;font-weight:900" onclick="removeItem(${i})">✖</button>
        </div>`;
      items.appendChild(row);
    });
    document.getElementById('cart-total').textContent = `Total: $${total.toFixed(2)}`;
  }
  modal.style.display = 'flex';
}
function closeCart(){ playClick(); document.getElementById('cart-modal').style.display = 'none'; }
function removeItem(i){ playClick(); if(i>=0 && i<cart.length) cart.splice(i,1); updateCartCount(); openCart(); }

/* ===== Payment selection & Buy ===== */
function selectPayment(btn){
  playClick();
  document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  selectedPayment = btn.getAttribute('data-val');
}
function buyItems(){
  playClick();
  if(cart.length === 0){ closeCart(); return; }
  // No alert, direct redirect:
  window.location.href = DISCORD_INVITE;
}

/* ===== Add-to-cart flying star with trail ===== */
function animateAddToCartAndAdd(product, imgEl){
  playClick();
  const imgRect = imgEl.getBoundingClientRect();
  const startX = imgRect.left + imgRect.width/2;
  const startY = imgRect.top + imgRect.height/2;
  const cartBtn = document.querySelector('.cart-button');
  const cartRect = cartBtn.getBoundingClientRect();
  const endX = cartRect.left + cartRect.width/2;
  const endY = cartRect.top + cartRect.height/2;

  const star = document.createElement('div');
  star.className = 'fly-star';
  star.style.left = startX + 'px';
  star.style.top = startY + 'px';
  star.style.transform = 'translate(-50%,-50%) scale(1)';
  star.style.opacity = '1';
  star.innerHTML = '⭐';
  // match nebula tint
  star.style.color = '#ffb0ee';
  star.style.textShadow = '0 6px 18px rgba(255,140,220,.22), 0 0 36px rgba(120,240,255,.10)';
  document.body.appendChild(star);

  const trailCount = 8;
  const trails = [];
  const trailColors = ['#ffb2ee','#c9a1ff','#9fe8ff'];
  for(let i=0;i<trailCount;i++){
    const f = document.createElement('div'); f.className='trail'; f.innerHTML='✦';
    const size = 8 + Math.round(Math.random()*12);
    f.style.fontSize = size + 'px';
    f.style.color = trailColors[i % trailColors.length];
    f.style.left = (startX + (Math.random()*28 - 14)) + 'px';
    f.style.top = (startY + (Math.random()*28 - 14)) + 'px';
    f.style.opacity = 0.95 - i*0.08;
    f.style.transform = `translate(-50%,-50%) rotate(${Math.random()*80}deg)`;
    f.style.transition = 'transform 900ms cubic-bezier(.2,.9,.3,1), left 900ms, top 900ms, opacity 700ms';
    document.body.appendChild(f);
    trails.push(f);
  }

  requestAnimationFrame(()=>{
    const dx = endX - startX, dy = endY - startY;
    star.style.transform = `translate(${dx}px, ${dy}px) scale(.28)`;
    star.style.opacity = '.98';
    trails.forEach((f, idx) => {
      const factor = 0.22 + idx*0.12 + Math.random()*0.06;
      const tx = startX + dx * factor + (Math.random()*24 - 12);
      const ty = startY + dy * factor + (Math.random()*42 - 18);
      f.style.left = tx + 'px';
      f.style.top = ty + 'px';
      f.style.opacity = Math.max(0.04, 0.95 - idx*0.12);
      f.style.transform = `translate(-50%,-50%) scale(${0.7 - idx*0.06}) rotate(${(idx*36 + Math.random()*60)}deg)`;
    });
  });

  setTimeout(()=>{
    star.style.opacity = '0';
    trails.forEach(f=>f.style.opacity = '0');
    setTimeout(()=>{
      if(star && star.parentNode) star.parentNode.removeChild(star);
      trails.forEach(f=>{ if(f && f.parentNode) f.parentNode.removeChild(f); });
    }, 380);

    cart.push(product);
    updateCartCount();
    const cartBtn = document.querySelector('.cart-button');
    cartBtn.animate([{transform:'translateY(0)'},{transform:'translateY(-8px)'},{transform:'translateY(0)'}],{duration:360,easing:'cubic-bezier(.2,.9,.3,1)'});
  }, 920);
}

/* ===== Init ===== */
function init(){
  // Fill explicit All Products button behavior, show intro
  const dl = document.getElementById('discord-link'); if(dl){ dl.href = DISCORD_INVITE; dl.target='_blank'; }
  renderCategories();
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') resetIntro(); });
}
init();
</script>
</body>
</html>
